@model System.Collections.Generic.IEnumerable<Hotel_Management.Models.BuildingFloorViewModel>

@{
    ViewBag.Title = "Danh sách Tòa nhà và Tầng";
}

<!-- THÔNG BÁO XÓA THÀNH CÔNG -->
@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show text-center fw-bold" role="alert" style="max-width: 600px; margin: 0 auto;">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <script>
        setTimeout(function () {
            var alert = document.getElementById('success-alert');
            if (alert) {
                alert.classList.remove('show');
                alert.classList.add('fade');
                setTimeout(() => alert.remove(), 500);
            }
        }, 3000);
    </script>
}

<h2 class="mb-4">Danh sách Tòa nhà và Tầng</h2>

<!-- Thanh công cụ: Thêm + Tìm kiếm -->
<div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <div>
        @Html.ActionLink("➕ Thêm Tòa nhà mới", "Create", null, new { @class = "btn btn-success" })
    </div>

    @using (Html.BeginForm("Index", "BuildingFloor", FormMethod.Get, new { @class = "d-flex align-items-center gap-2" }))
    {
        <label for="searchString" class="me-2 mb-0">Tìm kiếm:</label>
        <input type="text" name="searchString" value="@Request.QueryString["searchString"]" class="form-control me-2" placeholder="Nhập ID, tên, địa chỉ..." />
        <button type="submit" class="btn btn-primary me-2">🔍 Tìm</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">✖ Bỏ lọc</a>
    }
</div>

<!-- BẢNG HIỂN THỊ TÒA NHÀ -->
<table class="table table-bordered table-hover">
    <thead class="table-dark">
        <tr>
            <th style="width: 10%;">ID</th>
            <th style="width: 20%;">Tên Tòa nhà</th>
            <th style="width: 25%;">Địa chỉ</th>
            <th>Danh sách Tầng</th>
            <th style="width: 15%;">Thao tác</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var building in Model)
        {
            <tr>
                <td>@building.BuildingID</td>
                <td>@building.BuildingName</td>
                <td>@building.Address</td>
                <td>
                    @if (building.Floors != null && building.Floors.Any())
                    {
                        <ul class="mb-0 ps-3">
                            @foreach (var floor in building.Floors.OrderBy(f => f.FloorNumber))
                            {
                                <li>
                                    <strong>Tầng:</strong>
                                    @if (floor.FloorNumber < 0)
                                    {
                                        <span class="text-danger">Không hợp lệ (floor &lt; 0)</span>
                                    }
                                    else
                                    {
                                        @floor.FloorNumber
                                    }
                                    - <strong>Phòng:</strong> @floor.TotalRoomsOfFloor
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <span class="text-muted fst-italic">Không có tầng nào</span>
                    }
                </td>
                <td>
                    @Html.ActionLink("✏️ Sửa", "Edit", new { id = building.BuildingID }, new { @class = "btn btn-sm btn-primary mb-1" }) <br />
                    @Html.ActionLink("🗑 Xóa", "Delete", new { id = building.BuildingID }, new { onclick = "return confirm('Bạn có chắc muốn xóa không?')", @class = "btn btn-sm btn-danger" })
                </td>
            </tr>
        }
    </tbody>
</table>
